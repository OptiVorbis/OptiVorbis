[package]
name = "optivorbis"
description = "A lossless, format-preserving, two-pass Vorbis optimization and repair library"
authors.workspace = true
license = "AGPL-3.0-or-later OR BSD-3-Clause"
version.workspace = true
homepage.workspace = true
repository.workspace = true
readme = "../../README.md"
keywords.workspace = true
categories.workspace = true
edition.workspace = true
rust-version.workspace = true
# Run cargo diet to maintain this include list
include = ["src/**/*", "LICENSE.BSD-3-Clause", "LICENSE", "build.rs"]

[dependencies]
ogg = "0.9.0"
vorbis_bitpack.workspace = true

indexmap = "1.9.3"
bumpalo = "3.12.0"
tinyvec = { version = "1.6.0", default-features = false, features = ["alloc", "rustc_1_55"] }

getrandom = "0.2.8"
rand_xoshiro = "0.6.0"

thiserror = "1.0.40"
strum_macros = "0.24.3"
ouroboros = "0.15.6"
slice-group-by = "0.3.0"

log.workspace = true

# Pin wasm-bindgen as a temporary workaround for a critical regression:
# https://github.com/rustwasm/wasm-bindgen/issues/3276
wasm-bindgen = { version = "=0.2.83", default-features = false, optional = true }
wee_alloc = { version = "0.4.5", optional = true }
console_log = { version = "1.0.0", features = ["color"], optional = true }
console_error_panic_hook = { version = "0.1.7", optional = true }

[lib]
crate-type = ["lib", "cdylib"]

[build-dependencies]
git2 = { version = "0.16.1", default-features = false }
time = { version = "0.3.20", default-features = false, features = ["std"] }

[dev-dependencies]
pretty_env_logger = "0.4.0"
oggvorbismeta = "0.1.0"

[features]
wasm-bindings = ["wasm-bindgen", "wee_alloc"]
wasm-web-bindings = ["wasm-bindings", "console_log", "console_error_panic_hook", "getrandom/js"]
